name: Release
on: 
  push: 
    branches: 
      - main
  workflow_dispatch:
env: 
  VERSION: '7.0.0'
jobs: 
  build: 
    runs-on: ubuntu-latest
    steps: 
      - name: Checkout code
        uses: actions/checkout@v2
        
      - name: Remove unwanted files
        run: |
          rm -rf my_workspaces/.my_workspaces
          rm -rf README.md
          rm -rf README_EN.md
          rm -rf .git
          rm -rf .github
          
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env: 
          GITHUB_TOKEN: ${{ secrets.MY_TOKEN }}
        with: 
          tag_name: ${{ env.VERSION }}
          release_name: UY-Scuti ${{ env.VERSION }}
          draft: false
          prerelease: false
          body: |
            ## 更新内容
            ### 新的功能
            01. super 打包前，如果你已经打包了子分区，现在会询问你是否要移动到 super 文件夹，这样无需手动移动。
            02. 构建刷机包现在如果 Repacked 目录有打包的分区，会显示“轻松移动”，使用后会将它们快速移动到指定目录 Ready-to-flash/images。
            03. 英文翻译得到标准优化，采用新方法翻译。

            ## Release Notes
            ### New Features
            01. Before packaging the super, if you have already packaged subpartitions, it will now ask if you want to move them to the super folder, eliminating the need for manual moving.
            02. When building the flash package, if there are packaged partitions in the Repacked directory, "Easy Move" will now appear, allowing you to quickly move them to the specified directory Ready-to-flash/images.
            03. English translation has been standardized and optimized using a new method.

      - name: Archive project
        run: zip -r UY-Sct_${{ env.VERSION }}.zip .
        
      - name: Upload Release Asset
        id: upload_release_asset
        uses: actions/upload-release-asset@v1
        env: 
          GITHUB_TOKEN: ${{ secrets.MY_TOKEN }}
        with: 
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./UY-Sct_${{ env.VERSION }}.zip
          asset_name: UY-Sct_${{ env.VERSION }}.zip
          asset_content_type: application/zip

